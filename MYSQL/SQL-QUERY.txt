CREATE DATABASE library;
CREATE DATABASE library_test;
DROP DATABASE library_test;
CREATE TABLE books ( ID INT NOT NULL, 
                    BOOK_NAME VARCHAR(100), 
                    BOOK_TITLE VARCHAR(100), 
                    AUTHOR_NAME VARCHAR(100), 
                    AUTHOR_COUNTRY VARCHAR(100), 
                    YEAR INT NULL, 
                    PRICE FLOAT,
                   PRIMARY KEY(ID)
                   );
CREATE TABLE DUPLICATE_BOOKS ( ID INT NOT NULL, 
                    BOOK_NAME VARCHAR(100), 
                    BOOK_TITLE VARCHAR(100), 
                    AUTHOR_NAME VARCHAR(100), 
                    AUTHOR_COUNTRY VARCHAR(100), 
                    YEAR INT NULL, 
                    PRICE FLOAT,
                   PRIMARY KEY(ID)
                   );
CREATE TABLE user_books (ID INT NOT NULL, 
			USER_NAME VARCHAR(100), 
			BOOK_ID INT, 
			USER_COUNTRY VARCHAR(100)
			 );
DROP TABLE DUPLICATE_BOOKS;
TRUNCATE TABLE BOOKS; -- TO CLEAR ALL RECORDS WITHOUT USING WHERE CLAUSE

ALTER TABLE BOOKS
ADD AUTHOR_COUNTRY VARCHAR(100);

ALTER TABLE books ADD CITY VARCHAR(100);

ALTER TABLE books
DROP COLUMN CITY;

ALTER TABLE books
MODIFY COLUMN BOOK_NAME VARCHAR(100) NOT NULL;

ALTER TABLE books
ADD CHECK (PRICE <= 5000);

INSERT INTO BOOKS VALUES (100,'ABCD','XYZ','HJIK','AUH',2013,500);
INSERT INTO BOOKS VALUES (104,'ABFRCD','RGXYZ','HJIK','NZ',2013,500);

INSERT INTO BOOKS VALUES 
(101,'ABCDEF','VWXYZ','HJIKLM','NZ',2013,3500),
(102,'QSTU','STUV','HJIK','US',2013,1500),
(103,'DEFG','HIJK','HJIK','AUS',2013,4500);

SELECT * FROM BOOKS;

SELECT DISTINCT AUTHOR_NAME FROM BOOKS;

SELECT * FROM `BOOKS` WHERE AUTHOR_NAME="HJIK";
SELECT * FROM `BOOKS` WHERE AUTHOR_NAME="HJIK" AND AUTHOR_COUNTRY="NZ" ;

SELECT BOOK_NAME FROM `BOOKS` 
WHERE AUTHOR_COUNTRY IN ('NZ','AUS');

SELECT BOOK_NAME 
FROM BOOKS 
WHERE AUTHOR_COUNTRY='NZ' OR AUTHOR_COUNTRY='AUS';

SELECT BOOK_NAME 
FROM BOOKS
WHERE NOT AUTHOR_COUNTRY='NZ';

SELECT BOOK_NAME FROM `books` ORDER BY PRICE ASC;

SELECT * FROM BOOKS LIMIT 3;

UPDATE books
SET AUTHOR_NAME="CHETAN BHAGAT"
WHERE ID=103;

UPDATE books
SET BOOK_TITLE='EXPENSIVE'
WHERE PRICE>2000;

DELETE FROM books
WHERE AUTHOR_NAME='BVHF';

DELETE FROM TBL;

select book_name,max(price) from books where AUTHOR_COUNTRY='US' ;
SELECT BOOK_NAME,min(price) from books WHERE AUTHOR_NAME='hjik';

select BOOK_NAME,min(YEAR)
from books;

SELECT BOOK_NAME,max(year)
FROM `books` ;

SELECT BOOK_NAME
FROM BOOKS
ORDER BY YEAR
LIMIT 1;

SELECT * FROM `books` ORDER BY year DESC limit 1;

SELECT sum(price) AS TotalPrice FROM `books` WHERE AUTHOR_NAME='hjik';

SELECT AVG(price) AS AveragePrice
FROM `books`; 

SELECT AVG(price) AS AveragePrice FROM `books` WHERE AUTHOR_NAME='hjik';

SELECT BOOK_NAME FROM `books` WHERE BOOK_NAME LIKE 'a___%';

SELECT * 
FROM `books` 
WHERE AUTHOR_NAME LIKE '%m';

SELECT * 
FROM `books` 
WHERE BOOK_NAME NOT LIKE 'a%';

SELECT * 
FROM `books` 
WHERE BOOK_TITLE LIKE '%en%';

SELECT * 
FROM `books` 
WHERE AUTHOR_COUNTRY IN ('us','nz','aus');

SELECT * 
FROM BOOKS
WHERE AUTHOR_COUNTRY NOT IN ('us','nz');

SELECT * 
FROM `BOOKS` 
WHERE YEAR BETWEEN 2003 AND 2013;

SELECT * 
FROM `BOOKS` 
WHERE price BETWEEN 500 AND 1000;

SELECT ID AS BookID,YEAR AS PublishedYear 
FROM `BOOKS`;

SELECT CONCAT(BOOK_TITLE,',',AUTHOR_NAME,',',YEAR) AS Description
FROM `BOOKS`


SQL JOINS

Table 1

ID	BOOK_NAME	BOOK_TITLE	AUTHOR_NAME	AUTHOR_COUNTRY	YEAR	PRICE
100 	ABCD 		XYZ 		HJIK 		AUH 		2013 	500
101 	ABCDEF 		EXPENSIVE 	HJIKLM 		NZ 		2013 	3500
102 	QSTU 		STUV 		HJIK 		US 		2019 	1500
103 	DEFG 		EXPENSIVE 	CHETAN BHAGAT 	AUS 		2013 	4500
104 	ABFRCD 		RGXYZ 		HJIK 		NZ 		2013 	500
105 	QSTU 		EXPENSIVE 	FGHY 		US 		2018 	4550
107 	ABCDEF 		EXPENSIVE 	HJIKLM 		NZ 		2003 	3500

Table 2
ID	USER_NAME	BOOK_ID	USER_COUNTRY 	
101 	arun 		1001 	auh
102 	anu 		1003 	aus
103 	riya 		1002 	nz
104 	tinu 		1009 	us
109 	miya 		1008 	aus
110 	nivaan 		1111 	aus

SELECT books.book_name,books.AUTHOR_NAME,books.PRICE,user_books.USER_NAME 
FROM books 
INNER JOIN user_books 
ON books.ID=user_books.ID;

book_name	AUTHOR_NAME	PRICE	USER_NAME 	
ABCDEF 		HJIKLM 		3500 	arun
QSTU 		HJIK 		1500 	anu
DEFG 		CHETAN BHAGAT 	4500 	riya
ABFRCD 		HJIK 		500 	tinu



SELECT books.book_name,books.AUTHOR_NAME,books.PRICE 
FROM books 
INNER JOIN user_books 
ON books.ID=user_books.ID 
WHERE user_books.USER_NAME='riya';

book_name 	AUTHOR_NAME 	PRICE 	
DEFG 		CHETAN BHAGAT 	4500

left join

CREATE TABLE AGENTS(AGENT_ID INT AUTO_INCREMENT PRIMARY KEY NOT NULL ,NAME VARCHAR(100),CITY VARCHAR(100),COMMISION INT);

CREATE TABLE CUSTOMERS(CUSTOMER_ID INT AUTO_INCREMENT PRIMARY KEY NOT NULL ,NAME VARCHAR(100),CITY VARCHAR(100),AGENT_ID INT);

CREATE TABLE ORDERS(ORDER_ID INT AUTO_INCREMENT PRIMARY KEY NOT NULL ,CUSTOMER_ID INT,AGENT_ID INT,PURCHASE_AMT FLOAT,ORDER_DATE DATE,NO_OF_ITEMS INT);

taBLE AGENTS

AGENT_ID	NAME	CITY	COMMISION
1 		ABC 	TVM 	50000
2 		EFG 	ATL 	15000
3 		XYZ 	KZM 	45000
4 		STU 	ATL 	35000
5 		MNO 	KZM 	50000

TABLE CUSTOMERS

CUSTOMER_ID	NAME	CITY	AGENT_ID
1 		BINI 	TVM 	8
3 		ARUN 	TVM 	1
4 		CINU 	KZM 	3
5 		ANU 	ATL 	5
8 		RIYA 	TVM 	9

TABLE ORDERS

ORDER_ID	CUSTOMER_ID	AGENT_ID	PURCHASE_AMT	ORDER_DATE	NO_OF_ITEMS
1 		1 		4 		11000 		2001-02-10 	9
3 		1 		2 		5000 		2011-12-14 	5
4 		2 		3 		15000 		1998-10-02 	15
8 		4 		9 		45000 		2017-06-21 	11

SELECT CUSTOMERS.CUSTOMER_ID,CUSTOMERS.NAME,ORDERS.ORDER_ID,ORDERS.PURCHASE_AMT
FROM customers
INNER JOIN orders
ON customers.AGENT_ID= ORDERS.AGENT_ID;

 CUSTOMER_ID	NAME	ORDER_ID	PURCHASE_AMT 	
	4 	CINU 	4 		15000
	8 	RIYA 	8 		45000


SELECT CUSTOMERS.CUSTOMER_ID,CUSTOMERS.NAME,ORDERS.ORDER_ID,ORDERS.PURCHASE_AMT 
FROM ((customers 
LEFT JOIN orders ON customers.AGENT_ID= ORDERS.AGENT_ID) 
LEFT JOIN agents ON agents.AGENT_ID=orders.AGENT_ID);

CUSTOMER_ID	NAME	ORDER_ID	PURCHASE_AMT 	
4	 	CINU 	4 		15000
8 		RIYA 	8 		45000
1 		BINI 	NULL 		NULL
3 		ARUN 	NULL 		NULL
5 		ANU 	NULL 		NULL 


RIGHT JOIN

select orders.order_Id,customers.CUSTOMER_ID,customers.NAME
from orders
RIGHT JOIN customers
ON orders.AGENT_ID=customers.AGENT_ID;

order_Id	CUSTOMER_ID	NAME 	
4 	4 	CINU
8 	8 	RIYA
NULL 	1 	BINI
NULL 	3 	ARUN
NULL 	5 	ANU

----------------------------------------------------------------------------------------------------------------

sql union

SELECT NAME,CITY
FROM agents
WHERE CITY='ATL'
UNION ALL
SELECT NAME,CITY
FROM customers
WHERE CITY='ATL';


SELECT NAME,CITY 
FROM agents

SELECT AGENT_ID,NAME
FROM agents
UNION
SELECT CUSTOMER_ID,NAME
FROM customers;

SELECT AGENT_ID,NAME,CITY
FROM agents
WHERE CITY='ATL'
UNION
SELECT CUSTOMER_ID,NAME,CITY
FROM customers
WHERE CITY='ATL';

SELECT * 
FROM agents 
WHERE CITY NOT IN('TVM','ATL','KZM') 
UNION 
SELECT * 
FROM customers 
WHERE CITY NOT IN('TVM','ATL','KZM');

sql order By

SELECT * FROM ORDERS ORDER BY PURCHASE_AMT DESC,ORDER_DATE ASC 

SQL GROUP BY

SELECT COUNT(AGENT_ID),CITY
FROM agents
GROUP BY CITY;

SELECT COUNT(AGENT_ID),CITY
FROM agents
GROUP BY CITY
ORDER BY COUNT(AGENT_ID) DESC;

SQL HAVING

SELECT COUNT(CUSTOMER_ID),CITY
FROM `customers` 
GROUP BY CITY
HAVING COUNT(CUSTOMER_ID)>3;

EXISTS

CREATE TABLE PRODUCTS(PRODUCT_ID INT PRIMARY KEY NOT NULL,NAME VARCHAR(100),PRICE FLOAT,AGENT_ID INT);

PRODUCT_ID	NAME		PRICE	AGENT_ID
101 		PENDRIVE 	500 	3
102 		LAPTOP 		45000 	5
103 		HARDDISK 	1500 	2
104 		SMARTTV 	65000 	2
105 		MOUSE 		700 	1

SELECT NAME,AGENT_ID
FROM `agents` 
WHERE EXISTS (SELECT AGENT_ID FROM products WHERE PRICE > 150);
	
SELECT * 
FROM PRODUCTS
WHERE AGENT_ID = ANY(SELECT AGENT_ID FROM ORDERS WHERE NO_OF_ITEMS > 10);

SELECT * 
FROM `PRODUCTS` 
WHERE AGENT_ID = ALL(SELECT AGENT_ID FROM ORDERS WHERE NO_OF_ITEMS > 10);

DATE

SELECT * 
FROM `orders` 
WHERE ORDER_DATE = '2017-06-21';
